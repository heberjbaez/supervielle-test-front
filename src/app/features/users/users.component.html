<div>
  <header>
    <h1>Listado de Usuarios</h1>
    <button (click)="logout()">Cerrar Sesión</button>
  </header>

  @if (loading()) {
    <p>Cargando usuarios...</p>
  } @else if (error()) {
    <p>Error: {{ error() }}</p>
  } @else {
    <div>
      <div class="filters">
        <div>
          <label for="search">Buscar por nombre o email:</label>
          <input
            id="search"
            type="text"
            [ngModel]="searchText()"
            (ngModelChange)="onSearchChange($event)"
            placeholder="Buscar..."
          />
        </div>

        <div>
          <label for="company">Filtrar por compañía:</label>
          <select
            id="company"
            [ngModel]="selectedCompany()"
            (ngModelChange)="onCompanyChange($event)"
          >
            <option value="">Todas las compañías</option>
            @for (company of companies(); track company) {
              <option [value]="company">{{ company }}</option>
            }
          </select>
        </div>

        <button (click)="clearFilters()">Limpiar filtros</button>
      </div>

      <div>
        <p>Mostrando {{ filteredUsers().length }} usuarios</p>
      </div>

      <table>
        <thead>
          <tr>
            <th>Username</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Compañía</th>
          </tr>
        </thead>
        <tbody>
          @if (paginatedUsers().length === 0) {
            <tr>
              <td colspan="4">No se encontraron usuarios</td>
            </tr>
          } @else {
            @for (user of paginatedUsers(); track user.id) {
              <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.company.name }}</td>
              </tr>
            }
          }
        </tbody>
      </table>

      <div class="pagination">
        <button (click)="previousPage()" [disabled]="currentPage() === 1">
          Anterior
        </button>

        <span>Página {{ currentPage() }} de {{ totalPages() }}</span>

        <button (click)="nextPage()" [disabled]="currentPage() === totalPages()">
          Siguiente
        </button>
      </div>
    </div>
  }
</div>